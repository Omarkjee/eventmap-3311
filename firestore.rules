service cloud.firestore {
  match /databases/{database}/documents {

    // Allow anyone to read and create documents in the "users" collection.
    // This allows new user data to be stored even if the user has not verified their email.
    match /users/{userId} {
      allow read: if true;
      allow create: if true;
      allow update, delete: if request.auth != null && request.auth.uid == userId;
    }

    // Allow public access to events, but restrict hosting (create, update, delete) to authenticated users.
    match /events/{eventId} {
      allow read: if true; // Anyone can read events
      allow create: if request.auth != null; // Only authenticated users can create events
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.host_id;
    }

    // Additional collections or documents with restricted access
    // Example: RSVP collection inside each event
    match /events/{eventId}/rsvps/{rsvpId} {
      allow create: if request.auth != null; // Only authenticated users can RSVP
      allow delete: if request.auth != null && request.auth.uid == resource.data.userId; // Only users who RSVP'd can delete their RSVP
    }
  }
}
